<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <title>W√ºrfelspiel - Casino Games</title>
    <script>
      (function(){
        try{
          if(localStorage.getItem('casino-dark-mode') === 'true'){
            document.documentElement.classList.add('dark-mode');
          }
          if(localStorage.getItem('casino-debug') === 'true'){
            document.documentElement.classList.add('debug');
          }
        }catch(e){}
      })();
    </script>
    <link rel="stylesheet" href="../css/styles.css" />
    <script src="../js/coin-system.js"></script>
  </head>
  <body>
    <div class="coin-display" title="Your Coins">
      <span class="coin-icon">ü™ô</span>
      <span class="coin-amount" data-coin-balance>0</span>
    </div>
    <div class="coin-actions">
      <button type="button" class="coin-btn coin-btn--secondary" aria-label="Remove 100 coins" onclick="window.Coins && Coins.spend(100)">-100</button>
      <button type="button" class="coin-btn" aria-label="Add 100 coins" onclick="window.Coins && Coins.add(100)">+100</button>
    </div>
    <div class="coin-debug-toggle">
      <button id="coin-debug-toggle-btn" type="button" class="coin-btn" onclick="toggleCoinDebug()">Enable Dev Coins</button>
    </div>
    <script>
      (function(){
        function setLabel(){
          var btn = document.getElementById('coin-debug-toggle-btn');
          if(!btn) return;
          var isOn = document.documentElement.classList.contains('debug');
          btn.textContent = isOn ? 'Disable Dev Coins' : 'Enable Dev Coins';
        }
        window.toggleCoinDebug = function(){
          var html = document.documentElement;
          var isOn = html.classList.toggle('debug');
          try { localStorage.setItem('casino-debug', isOn ? 'true' : 'false'); } catch(e){}
          setLabel();
        };
        if(document.readyState === 'loading') document.addEventListener('DOMContentLoaded', setLabel); else setLabel();
      })();
    </script>
    <div class="dark-mode-toggle">
      <label class="switch">
        <input type="checkbox" id="dark-mode-switch" />
        <span class="slider" aria-hidden="true"></span>
        <span class="switch-text">Dark Mode</span>
      </label>
    </div>
    <div class="container">
      <a href="../index.html" class="back-button">‚Üê Back to Home</a>
      <h1>Dice Game</h1>

      <div class="game-area">
        <div class="dice-row">
          <img
            id="meinBild1"
            src="https://media.tenor.com/WiTP5aZyPLUAAAAj/dice-roll-dice.gif"
            width="120"
          />
          <img
            id="meinBild2"
            src="https://media.tenor.com/WiTP5aZyPLUAAAAj/dice-roll-dice.gif"
            width="120"
          />
        </div>

        <h3>Output:</h3>
        <pre id="output"></pre>

        <div class="game-controls">
          <label for="betAmount">Bet (coins):</label>
          <input type="number" id="betAmount" min="1" value="5" />
          <label for="tippInput">Guess a number between 1 and 6:</label>
          <input type="number" id="tippInput" min="1" max="6" />
          <button onclick="runGame()">Roll Dice</button>
        </div>

        <div class="coin-rules" aria-label="Coin rules for Dice Game">
          <h4>Coin Rules</h4>
          <ul>
            <li>Roll costs your chosen bet (stake).</li>
            <li>Correct guess pays 4√ó your bet (stake already deducted).</li>
            <li>Wrong guess: no payout.</li>
          </ul>
        </div>
      </div>
    </div>

    <script>
      // --- Helper functions ---
      function rollDice() {
        return Math.floor(Math.random() * 6) + 1;
      }

      function printOutput(text) {
        const out = document.getElementById("output");
        out.textContent += text + "\n";
      }

      function runGame() {
        const bet = Math.max(1, parseInt(document.getElementById('betAmount').value) || 1);
        const guess = parseInt(document.getElementById("tippInput").value);
        const number = rollDice();

        if (guess > 6) {
          printOutput("Error: The entered number must not be greater than 6!");
          return;
        }

        if (isNaN(guess) || guess < 1) {
          printOutput("Error: Please enter a valid number between 1 and 6!");
          return;
        }

        // coin system: spend bet upfront
        if (!window.Coins || !Coins.trySpend(bet)) {
          printOutput("Not enough coins for this bet.");
          return;
        }

        if (guess === number) {
          printOutput("Congratulations! You guessed correctly: " + number);
          // payout: 4x bet (stake already deducted)
          if (window.Coins) Coins.add(bet * 4);
        } else {
          printOutput(
            "Sorry, wrong guess. You guessed " +
              guess +
              ", but the number was " +
              number +
              "."
          );
        }
      }

      function loadCode() {
        printOutput("Good luck rolling the dice!");
      }

      window.addEventListener("load", loadCode);
    </script>
    <script src="../js/darkmode.js"></script>
    <script src="../js/age-verify.js"></script>
  </body>
</html>
